# README.md　最終更新日 2025-06-13 Fri.

# Python Audio Dataset Creator

AI音声学習用の高品質な音声データセットを作成するための総合ツールです。  
複数のテキストファイルから1行ずつ台本を読み込み、各行に対して音声を録音し、  
「音声ファイル | 対応テキスト」のペアをメタデータとして保存します。

## ✨ 主な機能

- 📚 **複数テキストファイル対応**: `cocoro.txt`, `japanese.txt`など複数の原稿を統合管理
- 🎙️ **高品質録音**: 44.1kHz/16bit WAVファイルで録音
- ⏸️ **録音制御**: 録音の開始・一時停止・再開・停止が可能
- 🔄 **セッション管理**: 作業を中断・再開できる自動セーブ機能
- 📊 **進捗管理**: リアルタイムで録音進捗を表示
- 🎯 **柔軟なナビゲーション**: 任意の行にジャンプして録音可能
- 🔊 **音声プレビュー**: 録音した音声をその場で再生確認
- 🔄 **データ同期**: セッション状態と実際のファイルの自動同期
- 🧹 **重複防止**: 再録音時の重複データ自動管理
- 🔗 **AudioOpt連携**: 音声クローニング・学習アプリとの完全互換性

---

## 📁 プロジェクト構成

```
Python_Audio_dataset/
├── src/
│   ├── main.py              # メインアプリケーション
│   ├── text_manager.py      # テキスト・セッション管理
│   └── audio_recorder.py    # 音声録音・再生機能
├── script/
│   ├── check_audio_devices.py   # 音声デバイス確認ツール
│   ├── test_imports.py          # ライブラリ動作確認
│   └── convert_filenames.py     # ファイル名変換ツール
├── data/
│   ├── input/               # 原稿テキストファイル置き場
│   │   ├── cocoro.txt       # 夏目漱石「こころ」（サンプル）
│   │   └── japanese.txt     # 日本語音素練習用テキスト
│   └── session.json         # セッション状態（自動生成）
├── dataset/
│   ├── audio_files/         # 録音された音声ファイル(.wav)
│   │   ├── audio_1.wav      # 統一された命名規則
│   │   ├── audio_2.wav
│   │   └── ...
│   ├── meta_files/          # 各音声に対応するテキストファイル
│   │   ├── meta_1.txt       # audio_1.wavに対応
│   │   ├── meta_2.txt       # audio_2.wavに対応
│   │   └── ...
│   ├── backup/              # 変換前データのバックアップ
│   └── metadata.txt         # 全体のメタデータ（音声ファイル|テキスト）
├── Reports/                 # 開発・運用レポート（公開）
└── requirements.txt         # 必要なPythonパッケージ
```

---

## 🚀 セットアップ

### 1. 環境準備（conda推奨）

```bash
# conda環境を作成
conda create -n audio_dataset python=3.9
conda activate audio_dataset

# 必要なパッケージをインストール
pip install -r requirements.txt
```

### 2. 音声デバイス確認

```bash
# マイクとスピーカーの動作確認
python script/check_audio_devices.py
```

### 3. ライブラリ動作確認

```bash
# インストールされたライブラリの確認
python script/test_imports.py
```

---

## 📝 原稿ファイルの準備

### cocoro.txtの作成方法

`data/input/cocoro.txt`には夏目漱石の「こころ」の一部が含まれています。  
以下の形式で原稿を作成してください：

```
私はその人を、いつも先生と呼んでいました。
だからこの文章でも、本名は明かさずに先生とだけ書くことにします。
誰かに遠慮しているわけではありません。
```

### 原稿作成のガイドライン

- **1行1文**: 各行に1つの文章を記述
- **UTF-8エンコーディング**: 日本語の文字化けを防ぐため
- **適度な長さ**: 1文あたり10-50文字程度が録音しやすい
- **空行スキップ**: 空行は自動的に無視されます

### 推奨原稿の種類

- **文学作品**: 「こころ」「銀河鉄道の夜」など著作権切れの名作
- **音素練習**: あいうえお、かきくけこなど日本語の全音素
- **専門用語**: 特定分野の用語集
- **日常会話**: 自然な話し言葉のサンプル

---

## 🎮 使用方法

### 基本操作

```bash
# メインプログラムを実行
python src/main.py
```

### 操作コマンド

| コマンド | 機能 |
|---------|------|
| `r` | 録音開始/再開（3秒カウントダウン後） |
| `p` | 録音一時停止 |
| `s` | 録音停止・保存 |
| `l` | 録音音声の再生 |
| `n` | 次の台本へ移動 |
| `b` | 前の台本へ移動 |
| `j` | 指定行にジャンプ |
| `rf` | テキストファイル再読み込み |
| `sync` | セッション状態とファイル同期 |
| `status` | 詳細な進捗状況表示 |
| `cleanup` | 重複データのクリーンアップ |
| `q` | プログラム終了 |

### 画面表示

```
🎙️  AI音声学習用データセット作成ツール
============================================================
📄 原稿ファイル: cocoro.txt
📝 台本 (93/217): 彼が身につけていたのは、日本でいう「ふんどし」一枚だけでした。
📊 進捗: 93/217 録音済み (42.9%)
📍 状態: ✅ 録音済み

🎛️  操作コマンド:
   r     : 録音開始/再開
   p     : 録音一時停止
   s     : 録音停止・保存
   l     : 録音音声の再生
   n     : 次の台本へ
   b     : 前の台本へ
   j     : 指定行にジャンプ
   rf    : テキストファイル再読み込み
   sync  : セッション状態とファイル同期
   status: 詳細な進捗状況表示
   cleanup: 重複データのクリーンアップ
   q     : 終了
```

---

## 🔧 技術仕様

### 音声録音設定

- **ファイル形式**: WAV
- **サンプルレート**: 44.1kHz（CD品質）
- **ビット深度**: 16-bit
- **チャンネル**: 1（モノラル）
- **録音デバイス**: デフォルトマイク（自動選択）

### ファイル命名規則

- **音声ファイル**: `audio_N.wav`（Nは連番）
  - 例: `audio_1.wav`, `audio_2.wav`, `audio_100.wav`
- **メタテキスト**: `meta_N.txt`（音声ファイルと対応）
  - 例: `meta_1.txt`, `meta_2.txt`, `meta_100.txt`

### セッション管理

- 作業状況は`data/session.json`に自動保存
- プログラム再起動時に続きから作業可能
- 録音済み/未録音の状態を自動追跡
- 実際のファイル存在状況との自動同期

---

## 📊 データセット出力

### 生成されるファイル

1. **音声ファイル**: `dataset/audio_files/`
   - 各台本に対応するWAVファイル（audio_N.wav形式）
   
2. **個別テキスト**: `dataset/meta_files/`
   - 各音声に対応するテキストファイル（meta_N.txt形式）
   
3. **統合メタデータ**: `dataset/metadata.txt`
   - AI学習用の統合データセット
   - 形式: `音声ファイル名|対応テキスト`
   - 重複エントリの自動除去

### データセット例

```
# metadata.txt
audio_1.wav|私はその人を、いつも先生と呼んでいました。
audio_2.wav|だからこの文章でも、本名は明かさずに先生とだけ書くことにします。
audio_3.wav|誰かに遠慮しているわけではありません。
```

---

## 🔗 AudioOptプロジェクト連携

### 互換性の確保

本プロジェクトで作成したデータセットは、音声クローニング・学習プロジェクト「AudioOpt」と完全互換性があります。

#### データ形式の統一
- **音声ファイル**: `audio_N.wav` 形式で統一
- **メタファイル**: `meta_N.txt` 形式で統一
- **フォルダ構成**: AudioOptが期待する構成と一致

#### 連携フロー
```
Python_Audio_dataset → AudioOpt
     (録音作成)        (学習・生成)
         ↓               ↓
    audio_N.wav     前処理・訓練
    meta_N.txt      モデル診断
    metadata.txt    音声合成
```

### ファイル名変換

既存データを新形式に変換する場合：

```bash
# 既存ファイルの変換
python script/convert_filenames.py
```

変換機能：
- 旧形式 → 新形式への一括変換
- session.json内のファイル名参照更新
- 変換前データの自動バックアップ
- 変換結果の検証

---

## 🔍 トラブルシューティング

### マイクが認識されない

```bash
# 音声デバイスを確認
python script/check_audio_devices.py

# sounddeviceの再インストール
pip uninstall sounddevice
pip install sounddevice
```

### 録音コマンド（r）が使えない

1. **プログラム内で**:
   - `status`コマンドで録音状態を確認
   - `sync`コマンドでセッション同期
   - `Ctrl+C`でプログラム終了後、再起動

2. **録音状態リセット**: プログラム内で録音状態の完全リセット機能を実装済み

### 進捗数が合わない

1. **セッション同期**: `sync`コマンドを実行
2. **テキスト再読み込み**: `rf`コマンドでテキストファイルを再読み込み
3. **完全リセット**: `data/session.json`を削除して再起動

### 重複録音データ

1. **自動防止**: 再録音時に既存ファイル上書き確認
2. **クリーンアップ**: `cleanup`コマンドで重複除去
3. **手動削除**: metadata.txtから重複行を手動削除

### ファイル名形式の変更

既存プロジェクトで異なるファイル名形式を使用している場合：

```bash
# 変換スクリプトを実行
python script/convert_filenames.py

# 変換内容の確認
ls dataset/audio_files/    # audio_1.wav, audio_2.wav...
ls dataset/meta_files/     # meta_1.txt, meta_2.txt...
```

### 録音音質が悪い

1. マイクの位置を調整（口から20-30cm）
2. 静かな環境で録音
3. マイクの音量レベルを確認

### ファイルが保存されない

- `dataset/`フォルダのアクセス権限を確認
- ディスク容量を確認
- ウイルス対策ソフトの干渉を確認

---

## 🛡️ プライバシー・セキュリティ

- **個人データ保護**: 録音ファイルはローカルのみに保存
- **Git除外設定**: 音声データと個人原稿は`.gitignore`で除外
- **バックアップ保護**: `dataset/backup/`フォルダも非公開
- **開発レポート公開**: `Reports/`フォルダは開発ログとして公開

---

## 🎯 AI音声モデル学習での活用

### 推奨データセット規模

- **最小**: 30分（基本的な音声合成）
- **推奨**: 60-120分（高品質な音声合成）
- **最適**: 3-5時間（プロレベルの音声合成）

### データ品質管理

1. **一貫性の確保**: 同じ環境・機材・話し方で録音
2. **重複データの除去**: 自動クリーンアップ機能
3. **進捗の正確な管理**: セッション同期機能

### 学習時の注意点

1. **音質の一貫性**: 同じ環境・機材で録音
2. **話し方の統一**: 同じ話速・トーンを維持
3. **音素の網羅**: 日本語の全音素を含むテキストを使用
4. **データ整合性**: metadata.txtの重複エントリ除去

---

## 🆕 最新の改善点

### 2025年6月13日更新: AudioOpt連携対応
- ✅ **ファイル名形式統一**: audio_N.wav形式で音声クローニングアプリと互換性確保
- ✅ **変換ツール追加**: 既存データの新形式変換スクリプト
- ✅ **セッション同期**: ファイル名変更に対応したセッション管理
- ✅ **統合準備**: システム統合に向けた基盤整備完了

### 2025年6月10日更新: データ整合性向上
- ✅ **セッション-ファイル同期**: 実際のファイル状況とセッション状態の自動同期
- ✅ **重複録音防止**: 再録音時のファイル上書き確認と重複データ管理
- ✅ **詳細ステータス表示**: 未録音行の詳細表示機能
- ✅ **テキスト再読み込み**: プログラム再起動なしでテキストファイル更新反映
- ✅ **録音状態リセット**: 録音エラー時の完全状態リセット機能

### バグ修正履歴
- 🐛 **進捗表示の不整合**: セッションデータとファイル実態の同期問題を解決
- 🐛 **録音コマンド無効化**: 録音状態管理の改善で`r`コマンド常時使用可能
- 🐛 **テキスト更新反映**: セッション状態の強制同期で最新テキスト反映

---

## 📈 今後の開発予定

### システム統合（進行中）
- [ ] AudioOptとのデータ同期システム構築
- [ ] 統合メインアプリケーションの開発
- [ ] 録音→学習→生成の完全自動パイプライン

### 機能拡張
- [ ] 音声品質の自動評価機能
- [ ] ノイズ除去機能
- [ ] バッチ処理モード
- [ ] Web UI版の開発
- [ ] 多言語対応
- [ ] セッション暗号化
- [ ] 音声波形可視化

---

## 📄 ライセンス

このプロジェクトはオープンソースです。教育・研究目的での利用を推奨します。

## 🤝 貢献

バグ報告、機能提案、プルリクエストを歓迎します。

---

**AI音声学習用の高品質データセット作成を簡単に！**  
**AudioOptとの統合で、録音から音声生成まで一気通貫！**